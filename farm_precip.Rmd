---
title: "Farm Precipitation Trends"
output:
  html_notebook: default
  pdf_document: default
---

```{r, message=FALSE, echo=FALSE}
library(tidyverse)
library(lubridate)
library(forcats)
```

```{r, message=FALSE, echo=FALSE}
precip_data <- read_csv("farm_precip_15aug2018.csv")
```

```{r, echo=FALSE}
# Clean data
precip_clean <- precip_data %>% 
  mutate(date = mdy(date)) %>% 
  mutate(month = month(date, label = TRUE)) %>%
  mutate(year = year(date)) %>%
  mutate(precip_cat = cut(precip, breaks = c(0,.5,1,2,5), 
                               labels = c("<0.5", "0.5 - 0.99", 
                                             "1 - 1.99", "2+"), 
                               right = FALSE)) 
```

###Summary Data
```{r, echo=FALSE}
summary_by_year <- precip_clean %>% 
  group_by(year) %>% 
  summarise(sum(precip), n(), mean(precip), sd(precip), max(precip)) 
summary_by_year

summary_by_month <- precip_clean %>% 
  group_by(month) %>% 
  summarise(sum(precip), n(), mean(precip), sd(precip), max(precip)) 
summary_by_month

## Work on an average for each month across years
summary_month <- precip_clean %>% 
  group_by(month) %>% 
  mutate(month_sum = sum(precip)) %>% 
  ungroup() %>% 
  group_by(year) %>%
  summarise(month_mean = (month_sum / distinct()))
summary_month
```

###Plots
```{r, echo=FALSE, fig.width=10, fig.height=8}
# Bar Plot
precip_bar <- precip_clean %>% 
  group_by(month) %>%
  rename("Precipitation Category" = precip_cat) %>%
  ggplot() +
    geom_col(aes(x = month, y = precip, fill = `Precipitation Category`), 
             color = "black") +
    labs(x = "", y = "Precipitation Total (inches)", 
         title = "Three Oaks Farms Precipitation", 
         subtitle = "2014 - Present") +
    theme_minimal() +
    theme(axis.line = element_line(size = 1.2), 
          panel.grid.major.y = element_line(size = 0.5, color = "black"), 
          panel.grid.major.x = element_blank(), 
          axis.text.x = element_text(size = 8, color = "black", angle = 15), 
          axis.text.y = element_text(size = 14, color = "black"), 
          title = element_text(size = 17, color = "black"), 
          legend.text = element_text(size = 15), 
          legend.position = c(.85,.85)) +
    scale_fill_brewer(palette = "Blues")

precip_bar
```

```{r, echo=FALSE, fig.width=10, fig.height=8}
# Bar Plot
precip_bar_function <- function(df = precip_clean, yr) {
precip_bar <- df %>% 
  filter(year == yr) %>% 
  group_by(month) %>%
  rename("Precipitation Category" = precip_cat) %>% 
  ggplot() +
    geom_col(aes(x = month, y = precip, fill = `Precipitation Category`), 
             color = "black") +
    labs(x = "", y = "Precipitation Total (inches)", 
         title = "Three Oaks Farms Precipitation", 
         subtitle = yr) +
    theme_minimal() +
    theme(axis.line = element_line(size = 1.2), 
          panel.grid.major.y = element_line(size = 0.5, color = "black"), 
          panel.grid.major.x = element_blank(), 
          axis.text.x = element_text(size = 14, color = "black", angle = 15), 
          axis.text.y = element_text(size = 14, color = "black"), 
          title = element_text(size = 17, color = "black"), 
          legend.text = element_text(size = 15)) +
    scale_fill_brewer(palette = "Blues")
precip_bar
}

precip_bar_function(precip_clean, "2014")
precip_bar_function(precip_clean, "2015")
precip_bar_function(precip_clean, "2016")
precip_bar_function(precip_clean, "2017")
precip_bar_function(precip_clean, "2018")
```

```{r, echo=FALSE, fig.width=10, fig.height=8}
# Bar Plot
precip_bar <- precip_clean %>% 
  group_by(month) %>%
  rename("Precipitation Category" = precip_cat) %>%
  ggplot() +
    geom_col(aes(x = month, y = precip, fill = `Precipitation Category`), 
             color = "black") +
    labs(x = "", y = "Precipitation Total (inches)", 
         title = "Three Oaks Farms Precipitation") +
    theme_minimal() +
    theme(axis.line = element_line(size = 1.2), 
          panel.grid.major.y = element_line(size = 0.5, color = "black"), 
          panel.grid.major.x = element_blank(), 
          axis.text.x = element_text(size = 8, color = "black", angle = 15), 
          axis.text.y = element_text(size = 14, color = "black"), 
          title = element_text(size = 17, color = "black"), 
          legend.text = element_text(size = 15), 
          legend.position = c(.85,.2)) +
    scale_fill_brewer(palette = "Blues") +
    facet_wrap(~year)

precip_bar
```

